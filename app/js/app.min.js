// Preloader
const preloader = (function() {
  let percentTotal = 0,
    preloader = $("#preloader");

  let imgPath = $("*").map((index, element) => {
    let bg = $(element).css("background-image"); // url('/images/1.png')
    let img = $(element).is("img"); //true или false
    let path;

    if (bg !== "none") {
      path = bg
        .replace('url("', "") // '/images/1.png')
        .replace('")', ""); // '/images/1.png'
    }

    if (img) {
      path = $(element).attr("src");
    }
    return path;
  });

  const setPercent = (total, current) => {
    let percents = Math.ceil((current / total) * 100);

    $("#preloader__percent").text(percents + "%");

    if (percents >= 100) {
      preloader.fadeOut();
    }
  };

  let loadImages = images => {
    if (!images.length) {
      preloader.fadeOut();
    } else {
      images.forEach(img => {
        let fakeImg = $("<img>", {
          attr: {
            src: img
          }
        });

        fakeImg.on("load error", () => {
          percentTotal++;
          setPercent(images.length, percentTotal);
        });
      });
    }
  };

  return {
    init() {
      let imgs = imgPath.toArray();
      loadImages(imgs);
    }
  };
})();

$(function() {
  preloader.init();
});

// VARIABLES
// adjustment
const btn__close = document.querySelector(".btn__close"); // using in --pop up--, --  --
// section --do--
// --pop up--
const sidebar__mobile = document.querySelector(".nav-sidebar__mobile");
const transfer__menu = document.querySelector(".mobile__transfer__menu");
const menu__link = document.querySelectorAll(".transfer_item_link");

sidebar__mobile.addEventListener("click", e => {
  e.preventDefault();
  transfer__menu.style.top = "0px";
});
btn__close.addEventListener("click", e => {
  transfer__menu.style.top = "-9999px";
});
menu__link.forEach(link => {
  link.addEventListener("click", e => {
    e.preventDefault();
    transfer__menu.style.top = "-9999px";
  });
});

// burger --slider--
$(function() {
  var coloringDots = function(index) {
    $(".burger-slider")
      .find(".bottom__dots-item")
      .eq(index)
      .addClass("active_dot")
      .siblings()
      .removeClass("active_dot");
  };

  var generateDots = function() {
    $(".burger__carousel").each(function() {
      var dot = $("<li>", {
        attr: {
          class: "bottom__dots-item"
        },
        html: '<div class="bottom__dots-item__circle"></div>'
      });
      $(".bottom__dots-list").append(dot);
    });
  };

  generateDots();

  var moveSlide = function(container, slideNum) {
    var items = container.find(".burger__carousel"),
      activeSlide = items.filter(".burger_is-active");
    (reqItem = items.eq(slideNum)),
      (reqIndex = reqItem.index()),
      (list = container.find(".burger__carousel-list")),
      (duration = 500);

    if (reqItem.length) {
      list.animate(
        {
          left: -reqIndex * 100 + "%"
        },
        duration,
        function() {
          activeSlide.removeClass("burger_is-active");
          reqItem.addClass("burger_is-active");
          coloringDots(slideNum);
        }
      );
    }
  };

  $(".slider__btn").on("click", function(e) {
    e.preventDefault();

    var $this = $(this),
      container = $this.closest(".burger-slider"),
      items = $(".burger__carousel", container),
      activeItem = items.filter(".burger_is-active"),
      existedItem,
      edgeItem,
      reqItem;

    if ($this.hasClass("slider_btn_next")) {
      // вперед
      existedItem = activeItem.next();
      edgeItem = items.first();
    }
    if ($this.hasClass("slider_btn_prev")) {
      //назад
      existedItem = activeItem.prev();
      edgeItem = items.last();
    }
    reqItem = existedItem.length ? existedItem.index() : edgeItem.index();

    moveSlide(container, reqItem);
  });

  $("body").on("click", ".bottom__dots-item", function() {
    var $this = $(this),
      container = $this.closest(".burger-slider"),
      index = $this.index();
    moveSlide(container, index);
    coloringDots(index);
  });
});

// burger --ingridients--
const btnIngridients = document.querySelector(".block__float-ingridients");
const floatIngridients = document.querySelector(".float-ingridients__list");
const burger__container = document.querySelector(".burger-container");

btnIngridients.addEventListener("mousemove", e => {
  floatIngridients.style.opacity = "1";
  floatIngridients.style.left = "100%";
});

burger__container.addEventListener("mouseover", e => {
  floatIngridients.style.opacity = "0";
  floatIngridients.style.left = "-9999px";
});

// section --Team--
const team__item = document.querySelectorAll(".team__accordeon__item");
const items = document.querySelector(".team__accordeon__list");
const team__section = document.querySelector(".team");

items.addEventListener("click", e => {
  e.preventDefault();
  let target = e.target;

  if (target.className === "team__accordeon__link") {
    let item = target.closest(".team__accordeon__item");
    if (item.classList.contains("team_accordeon_item_active")) {
      item.classList.toggle("team_accordeon_item_active");
    } else {
      team__item.forEach(function(item, index) {
        item.classList.remove("team_accordeon_item_active");
      });
      item.classList.add("team_accordeon_item_active");
    }
  }
});
// section --menu--

const menuList = document.querySelector(".menu__accordeon__list");
const menuItem = document.querySelectorAll(".menu__accordeon__item");

menuList.addEventListener("click", e => {
  e.preventDefault();
  let target = e.target;
  if (target.className === "menu__accordeon__link__title") {
    let closestMenuItem = target.closest(".menu__accordeon__item");
    if (closestMenuItem.classList.contains("menu_accordeon_item_active")) {
      closestMenuItem.classList.toggle("menu_accordeon_item_active");
    } else {
      menuItem.forEach(function(closestMenuItem, index) {
        closestMenuItem.classList.remove("menu_accordeon_item_active");
      });
      closestMenuItem.classList.add("menu_accordeon_item_active");
    }
  }
});

function createOverlay(name, text) {
  const overlayElement = document.createElement("div");
  overlayElement.classList.add("reviews__overlay");

  const template = document.querySelector("#overlayReviews");
  overlayElement.innerHTML = template.innerHTML;

  const closeElement = overlayElement.querySelector(".reviews__overlay-close");
  closeElement.addEventListener("click", e => {
    e.preventDefault();
    document.body.removeChild(overlayElement);
  });
  const contentName = overlayElement.querySelector(
    ".reviews__overlay-content__name"
  );
  contentName.innerHTML = name;

  const contentText = overlayElement.querySelector(
    ".reviews__overlay-content__discription"
  );
  contentText.innerHTML = text;

  return overlayElement;
}

const openBtn = document.querySelectorAll(".review__btn__link");
const getName = document.querySelector(".review__name");
const getText = document.querySelector(".review__text");

var name = getName.innerHTML;

openBtn.forEach(evenBtn => {
  evenBtn.addEventListener("click", e => {
    var target = e.target;
    // var name = getText.previousSibling;
    var getText = target.previousSibling;
    var text = getText.previousSibling.innerHTML;
    const succesOverlay = createOverlay(name, text);
    document.body.appendChild(succesOverlay);
  });
});

// // --one page scroll--

const sections = $(".section");
const display = $(".maincontent");
let inScroll = false;
const mobileDetect = new MobileDetect(window.navigator.userAgent);
const isMobile = mobileDetect.mobile();

const setActiveMenuItem = itemEq => {
  $(".nav-sidebar__item")
    .eq(itemEq)
    .addClass("nav-sidebar_item_is-active")
    .siblings()
    .removeClass("nav-sidebar_item_is-active");
};

const performTransition = sectionEq => {
  const position = `${-sectionEq * 100}%`;

  if (inScroll) return;

  inScroll = true;

  sections
    .eq(sectionEq)
    .addClass("is-active")
    .siblings()
    .removeClass("is-active");
  display.css({
    transform: `translateY(${position})`,
    "-webkit-transform": `translateY(${position})`
  });
  const transitionDuration =
    parseInt(display.css("transition-duration")) * 1000; // time in ms
  setTimeout(() => {
    inScroll = false;
    setActiveMenuItem(sectionEq);
  }, transitionDuration + 300); // pf 300 мс проходит инерция мышки
};

const scrollToSection = direction => {
  const activeSection = sections.filter(".is-active");
  const nextSection = activeSection.next();
  const prevSection = activeSection.prev();

  if (direction === "up" && prevSection.length) {
    performTransition(prevSection.index());
  }
  if (direction === "down" && nextSection.length) {
    performTransition(nextSection.index());
  }
};

$(document).on({
  wheel: e => {
    const deltaY = e.originalEvent.deltaY;
    const direction = deltaY > 0 ? "down" : "up";

    scrollToSection(direction);
  },
  keydown: e => {
    switch (e.keyCode) {
      case 40:
        scrollToSection("down");
        break;
      case 38:
        scrollToSection("up");
        break;

        break;

      default:
        break;
    }
  },
  touchmove: e => e.preventDefault()
});

$("[data-scroll-to]").on("click", e => {
  e.preventDefault();

  const target = parseInt($(e.currentTarget).attr("data-scroll-to"));
  performTransition(target);
});

if (isMobile) {
  $(document).swipe({
    swipe: function(
      event,
      direction,
      distance,
      duration,
      fingerCount,
      fingerData
    ) {
      const swipeDirection = direction === "down" ? "up" : "down";
      scrollToSection(swipeDirection);
    }
  });
}

// Form

$("#form").on("submit", submitForm);

function submitForm(ev) {
  ev.preventDefault();
  var form = $(ev.target);
  request = ajaxForm(form);

  request.done(function(msg) {
    var mes = msg.mes,
      status = msg.status;
    if (status === "OK") {
      form.append('<p class="success">' + mes + "</p>");
    } else {
      form.append('<p class="error">' + mes + "</p>");
    }
  });
  request.fail(function(jqXHR, textStatus) {
    alert("Request failed: " + textStatus);
  });
}
// Univercity function for work with all forms
var ajaxForm = function(form) {
  var data = form.serialize(),
    url = form.attr("action");
  return $.ajax({
    type: "POST",
    url: url,
    dataType: "JSON",
    data: data
  });
};

//Yandex map

ymaps.ready(init);

var placemarks = [
  {
    latitude: 59.97,
    longitude: 30.31,
    hintContent: '<div class="map__hint">улица Литералов дом 19 </div>',
    balloonContent: [
      '<div class="map__balloon">',
      "Самые вкусные бургеры у нас! Заходите по адресу: ул. Литералов, д. 19",
      "</div>"
    ]
  },
  {
    latitude: 59.94,
    longitude: 30.25,
    hintContent: '<div class="map__hint">Малый проспект В О, д 64</div>',
    balloonContent: [
      '<div class="map__balloon">',
      "Самые вкусные бургеры у нас! Заходите по адресу: Малый проспект В О, д 64",
      "</div>"
    ]
  },
  {
    latitude: 59.93,
    longitude: 30.34,
    hintContent: '<div class="map__hint">наб. реки ФонтанкиБ д 56 </div>',
    balloonContent: [
      '<div class="map__balloon">',
      "Самые вкусные бургеры у нас! Заходите по адресу: наб. реки ФонтанкиБ д 56",
      "</div>"
    ]
  }
];

function init() {
  var map = new ymaps.Map("map", {
    center: [59.94, 30.32],
    zoom: 12,
    controls: ["zoomControl"],
    behaviors: ["drag"]
  });

  placemarks.forEach(function(obj) {
    var placemark = new ymaps.Placemark(
      [obj.latitude, obj.longitude],
      {
        hintContent: obj.hintContent,
        balloonContent: obj.balloonContent.join("")
      },
      {
        iconLayout: "default#image",
        iconImageHref: "../img/map/icon__point/map-marker.svg",
        iconImageSize: [46, 57],
        iconImageOffset: [-23, -57]
      }
    );
    map.geoObjects.add(placemark);
  });
  var clusterer = new ymaps.Clusterer({});
  map.geoObjects.add(clusterer);
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIFByZWxvYWRlclxuY29uc3QgcHJlbG9hZGVyID0gKGZ1bmN0aW9uKCkge1xuICBsZXQgcGVyY2VudFRvdGFsID0gMCxcbiAgICBwcmVsb2FkZXIgPSAkKFwiI3ByZWxvYWRlclwiKTtcblxuICBsZXQgaW1nUGF0aCA9ICQoXCIqXCIpLm1hcCgoaW5kZXgsIGVsZW1lbnQpID0+IHtcbiAgICBsZXQgYmcgPSAkKGVsZW1lbnQpLmNzcyhcImJhY2tncm91bmQtaW1hZ2VcIik7IC8vIHVybCgnL2ltYWdlcy8xLnBuZycpXG4gICAgbGV0IGltZyA9ICQoZWxlbWVudCkuaXMoXCJpbWdcIik7IC8vdHJ1ZSDQuNC70LggZmFsc2VcbiAgICBsZXQgcGF0aDtcblxuICAgIGlmIChiZyAhPT0gXCJub25lXCIpIHtcbiAgICAgIHBhdGggPSBiZ1xuICAgICAgICAucmVwbGFjZSgndXJsKFwiJywgXCJcIikgLy8gJy9pbWFnZXMvMS5wbmcnKVxuICAgICAgICAucmVwbGFjZSgnXCIpJywgXCJcIik7IC8vICcvaW1hZ2VzLzEucG5nJ1xuICAgIH1cblxuICAgIGlmIChpbWcpIHtcbiAgICAgIHBhdGggPSAkKGVsZW1lbnQpLmF0dHIoXCJzcmNcIik7XG4gICAgfVxuICAgIHJldHVybiBwYXRoO1xuICB9KTtcblxuICBjb25zdCBzZXRQZXJjZW50ID0gKHRvdGFsLCBjdXJyZW50KSA9PiB7XG4gICAgbGV0IHBlcmNlbnRzID0gTWF0aC5jZWlsKChjdXJyZW50IC8gdG90YWwpICogMTAwKTtcblxuICAgICQoXCIjcHJlbG9hZGVyX19wZXJjZW50XCIpLnRleHQocGVyY2VudHMgKyBcIiVcIik7XG5cbiAgICBpZiAocGVyY2VudHMgPj0gMTAwKSB7XG4gICAgICBwcmVsb2FkZXIuZmFkZU91dCgpO1xuICAgIH1cbiAgfTtcblxuICBsZXQgbG9hZEltYWdlcyA9IGltYWdlcyA9PiB7XG4gICAgaWYgKCFpbWFnZXMubGVuZ3RoKSB7XG4gICAgICBwcmVsb2FkZXIuZmFkZU91dCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpbWFnZXMuZm9yRWFjaChpbWcgPT4ge1xuICAgICAgICBsZXQgZmFrZUltZyA9ICQoXCI8aW1nPlwiLCB7XG4gICAgICAgICAgYXR0cjoge1xuICAgICAgICAgICAgc3JjOiBpbWdcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGZha2VJbWcub24oXCJsb2FkIGVycm9yXCIsICgpID0+IHtcbiAgICAgICAgICBwZXJjZW50VG90YWwrKztcbiAgICAgICAgICBzZXRQZXJjZW50KGltYWdlcy5sZW5ndGgsIHBlcmNlbnRUb3RhbCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiB7XG4gICAgaW5pdCgpIHtcbiAgICAgIGxldCBpbWdzID0gaW1nUGF0aC50b0FycmF5KCk7XG4gICAgICBsb2FkSW1hZ2VzKGltZ3MpO1xuICAgIH1cbiAgfTtcbn0pKCk7XG5cbiQoZnVuY3Rpb24oKSB7XG4gIHByZWxvYWRlci5pbml0KCk7XG59KTtcblxuLy8gVkFSSUFCTEVTXG4vLyBhZGp1c3RtZW50XG5jb25zdCBidG5fX2Nsb3NlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5idG5fX2Nsb3NlXCIpOyAvLyB1c2luZyBpbiAtLXBvcCB1cC0tLCAtLSAgLS1cbi8vIHNlY3Rpb24gLS1kby0tXG4vLyAtLXBvcCB1cC0tXG5jb25zdCBzaWRlYmFyX19tb2JpbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm5hdi1zaWRlYmFyX19tb2JpbGVcIik7XG5jb25zdCB0cmFuc2Zlcl9fbWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9iaWxlX190cmFuc2Zlcl9fbWVudVwiKTtcbmNvbnN0IG1lbnVfX2xpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnRyYW5zZmVyX2l0ZW1fbGlua1wiKTtcblxuc2lkZWJhcl9fbW9iaWxlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICB0cmFuc2Zlcl9fbWVudS5zdHlsZS50b3AgPSBcIjBweFwiO1xufSk7XG5idG5fX2Nsb3NlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHtcbiAgdHJhbnNmZXJfX21lbnUuc3R5bGUudG9wID0gXCItOTk5OXB4XCI7XG59KTtcbm1lbnVfX2xpbmsuZm9yRWFjaChsaW5rID0+IHtcbiAgbGluay5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRyYW5zZmVyX19tZW51LnN0eWxlLnRvcCA9IFwiLTk5OTlweFwiO1xuICB9KTtcbn0pO1xuXG4vLyBidXJnZXIgLS1zbGlkZXItLVxuJChmdW5jdGlvbigpIHtcbiAgdmFyIGNvbG9yaW5nRG90cyA9IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgJChcIi5idXJnZXItc2xpZGVyXCIpXG4gICAgICAuZmluZChcIi5ib3R0b21fX2RvdHMtaXRlbVwiKVxuICAgICAgLmVxKGluZGV4KVxuICAgICAgLmFkZENsYXNzKFwiYWN0aXZlX2RvdFwiKVxuICAgICAgLnNpYmxpbmdzKClcbiAgICAgIC5yZW1vdmVDbGFzcyhcImFjdGl2ZV9kb3RcIik7XG4gIH07XG5cbiAgdmFyIGdlbmVyYXRlRG90cyA9IGZ1bmN0aW9uKCkge1xuICAgICQoXCIuYnVyZ2VyX19jYXJvdXNlbFwiKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGRvdCA9ICQoXCI8bGk+XCIsIHtcbiAgICAgICAgYXR0cjoge1xuICAgICAgICAgIGNsYXNzOiBcImJvdHRvbV9fZG90cy1pdGVtXCJcbiAgICAgICAgfSxcbiAgICAgICAgaHRtbDogJzxkaXYgY2xhc3M9XCJib3R0b21fX2RvdHMtaXRlbV9fY2lyY2xlXCI+PC9kaXY+J1xuICAgICAgfSk7XG4gICAgICAkKFwiLmJvdHRvbV9fZG90cy1saXN0XCIpLmFwcGVuZChkb3QpO1xuICAgIH0pO1xuICB9O1xuXG4gIGdlbmVyYXRlRG90cygpO1xuXG4gIHZhciBtb3ZlU2xpZGUgPSBmdW5jdGlvbihjb250YWluZXIsIHNsaWRlTnVtKSB7XG4gICAgdmFyIGl0ZW1zID0gY29udGFpbmVyLmZpbmQoXCIuYnVyZ2VyX19jYXJvdXNlbFwiKSxcbiAgICAgIGFjdGl2ZVNsaWRlID0gaXRlbXMuZmlsdGVyKFwiLmJ1cmdlcl9pcy1hY3RpdmVcIik7XG4gICAgKHJlcUl0ZW0gPSBpdGVtcy5lcShzbGlkZU51bSkpLFxuICAgICAgKHJlcUluZGV4ID0gcmVxSXRlbS5pbmRleCgpKSxcbiAgICAgIChsaXN0ID0gY29udGFpbmVyLmZpbmQoXCIuYnVyZ2VyX19jYXJvdXNlbC1saXN0XCIpKSxcbiAgICAgIChkdXJhdGlvbiA9IDUwMCk7XG5cbiAgICBpZiAocmVxSXRlbS5sZW5ndGgpIHtcbiAgICAgIGxpc3QuYW5pbWF0ZShcbiAgICAgICAge1xuICAgICAgICAgIGxlZnQ6IC1yZXFJbmRleCAqIDEwMCArIFwiJVwiXG4gICAgICAgIH0sXG4gICAgICAgIGR1cmF0aW9uLFxuICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICBhY3RpdmVTbGlkZS5yZW1vdmVDbGFzcyhcImJ1cmdlcl9pcy1hY3RpdmVcIik7XG4gICAgICAgICAgcmVxSXRlbS5hZGRDbGFzcyhcImJ1cmdlcl9pcy1hY3RpdmVcIik7XG4gICAgICAgICAgY29sb3JpbmdEb3RzKHNsaWRlTnVtKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9XG4gIH07XG5cbiAgJChcIi5zbGlkZXJfX2J0blwiKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLFxuICAgICAgY29udGFpbmVyID0gJHRoaXMuY2xvc2VzdChcIi5idXJnZXItc2xpZGVyXCIpLFxuICAgICAgaXRlbXMgPSAkKFwiLmJ1cmdlcl9fY2Fyb3VzZWxcIiwgY29udGFpbmVyKSxcbiAgICAgIGFjdGl2ZUl0ZW0gPSBpdGVtcy5maWx0ZXIoXCIuYnVyZ2VyX2lzLWFjdGl2ZVwiKSxcbiAgICAgIGV4aXN0ZWRJdGVtLFxuICAgICAgZWRnZUl0ZW0sXG4gICAgICByZXFJdGVtO1xuXG4gICAgaWYgKCR0aGlzLmhhc0NsYXNzKFwic2xpZGVyX2J0bl9uZXh0XCIpKSB7XG4gICAgICAvLyDQstC/0LXRgNC10LRcbiAgICAgIGV4aXN0ZWRJdGVtID0gYWN0aXZlSXRlbS5uZXh0KCk7XG4gICAgICBlZGdlSXRlbSA9IGl0ZW1zLmZpcnN0KCk7XG4gICAgfVxuICAgIGlmICgkdGhpcy5oYXNDbGFzcyhcInNsaWRlcl9idG5fcHJldlwiKSkge1xuICAgICAgLy/QvdCw0LfQsNC0XG4gICAgICBleGlzdGVkSXRlbSA9IGFjdGl2ZUl0ZW0ucHJldigpO1xuICAgICAgZWRnZUl0ZW0gPSBpdGVtcy5sYXN0KCk7XG4gICAgfVxuICAgIHJlcUl0ZW0gPSBleGlzdGVkSXRlbS5sZW5ndGggPyBleGlzdGVkSXRlbS5pbmRleCgpIDogZWRnZUl0ZW0uaW5kZXgoKTtcblxuICAgIG1vdmVTbGlkZShjb250YWluZXIsIHJlcUl0ZW0pO1xuICB9KTtcblxuICAkKFwiYm9keVwiKS5vbihcImNsaWNrXCIsIFwiLmJvdHRvbV9fZG90cy1pdGVtXCIsIGZ1bmN0aW9uKCkge1xuICAgIHZhciAkdGhpcyA9ICQodGhpcyksXG4gICAgICBjb250YWluZXIgPSAkdGhpcy5jbG9zZXN0KFwiLmJ1cmdlci1zbGlkZXJcIiksXG4gICAgICBpbmRleCA9ICR0aGlzLmluZGV4KCk7XG4gICAgbW92ZVNsaWRlKGNvbnRhaW5lciwgaW5kZXgpO1xuICAgIGNvbG9yaW5nRG90cyhpbmRleCk7XG4gIH0pO1xufSk7XG5cbi8vIGJ1cmdlciAtLWluZ3JpZGllbnRzLS1cbmNvbnN0IGJ0bkluZ3JpZGllbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5ibG9ja19fZmxvYXQtaW5ncmlkaWVudHNcIik7XG5jb25zdCBmbG9hdEluZ3JpZGllbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5mbG9hdC1pbmdyaWRpZW50c19fbGlzdFwiKTtcbmNvbnN0IGJ1cmdlcl9fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5idXJnZXItY29udGFpbmVyXCIpO1xuXG5idG5JbmdyaWRpZW50cy5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIGUgPT4ge1xuICBmbG9hdEluZ3JpZGllbnRzLnN0eWxlLm9wYWNpdHkgPSBcIjFcIjtcbiAgZmxvYXRJbmdyaWRpZW50cy5zdHlsZS5sZWZ0ID0gXCIxMDAlXCI7XG59KTtcblxuYnVyZ2VyX19jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCBlID0+IHtcbiAgZmxvYXRJbmdyaWRpZW50cy5zdHlsZS5vcGFjaXR5ID0gXCIwXCI7XG4gIGZsb2F0SW5ncmlkaWVudHMuc3R5bGUubGVmdCA9IFwiLTk5OTlweFwiO1xufSk7XG5cbi8vIHNlY3Rpb24gLS1UZWFtLS1cbmNvbnN0IHRlYW1fX2l0ZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnRlYW1fX2FjY29yZGVvbl9faXRlbVwiKTtcbmNvbnN0IGl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50ZWFtX19hY2NvcmRlb25fX2xpc3RcIik7XG5jb25zdCB0ZWFtX19zZWN0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50ZWFtXCIpO1xuXG5pdGVtcy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcbiAgbGV0IHRhcmdldCA9IGUudGFyZ2V0O1xuXG4gIGlmICh0YXJnZXQuY2xhc3NOYW1lID09PSBcInRlYW1fX2FjY29yZGVvbl9fbGlua1wiKSB7XG4gICAgbGV0IGl0ZW0gPSB0YXJnZXQuY2xvc2VzdChcIi50ZWFtX19hY2NvcmRlb25fX2l0ZW1cIik7XG4gICAgaWYgKGl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKFwidGVhbV9hY2NvcmRlb25faXRlbV9hY3RpdmVcIikpIHtcbiAgICAgIGl0ZW0uY2xhc3NMaXN0LnRvZ2dsZShcInRlYW1fYWNjb3JkZW9uX2l0ZW1fYWN0aXZlXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0ZWFtX19pdGVtLmZvckVhY2goZnVuY3Rpb24oaXRlbSwgaW5kZXgpIHtcbiAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKFwidGVhbV9hY2NvcmRlb25faXRlbV9hY3RpdmVcIik7XG4gICAgICB9KTtcbiAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZChcInRlYW1fYWNjb3JkZW9uX2l0ZW1fYWN0aXZlXCIpO1xuICAgIH1cbiAgfVxufSk7XG4vLyBzZWN0aW9uIC0tbWVudS0tXG5cbmNvbnN0IG1lbnVMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tZW51X19hY2NvcmRlb25fX2xpc3RcIik7XG5jb25zdCBtZW51SXRlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubWVudV9fYWNjb3JkZW9uX19pdGVtXCIpO1xuXG5tZW51TGlzdC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcbiAgbGV0IHRhcmdldCA9IGUudGFyZ2V0O1xuICBpZiAodGFyZ2V0LmNsYXNzTmFtZSA9PT0gXCJtZW51X19hY2NvcmRlb25fX2xpbmtfX3RpdGxlXCIpIHtcbiAgICBsZXQgY2xvc2VzdE1lbnVJdGVtID0gdGFyZ2V0LmNsb3Nlc3QoXCIubWVudV9fYWNjb3JkZW9uX19pdGVtXCIpO1xuICAgIGlmIChjbG9zZXN0TWVudUl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKFwibWVudV9hY2NvcmRlb25faXRlbV9hY3RpdmVcIikpIHtcbiAgICAgIGNsb3Nlc3RNZW51SXRlbS5jbGFzc0xpc3QudG9nZ2xlKFwibWVudV9hY2NvcmRlb25faXRlbV9hY3RpdmVcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1lbnVJdGVtLmZvckVhY2goZnVuY3Rpb24oY2xvc2VzdE1lbnVJdGVtLCBpbmRleCkge1xuICAgICAgICBjbG9zZXN0TWVudUl0ZW0uY2xhc3NMaXN0LnJlbW92ZShcIm1lbnVfYWNjb3JkZW9uX2l0ZW1fYWN0aXZlXCIpO1xuICAgICAgfSk7XG4gICAgICBjbG9zZXN0TWVudUl0ZW0uY2xhc3NMaXN0LmFkZChcIm1lbnVfYWNjb3JkZW9uX2l0ZW1fYWN0aXZlXCIpO1xuICAgIH1cbiAgfVxufSk7XG5cbmZ1bmN0aW9uIGNyZWF0ZU92ZXJsYXkobmFtZSwgdGV4dCkge1xuICBjb25zdCBvdmVybGF5RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIG92ZXJsYXlFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJyZXZpZXdzX19vdmVybGF5XCIpO1xuXG4gIGNvbnN0IHRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNvdmVybGF5UmV2aWV3c1wiKTtcbiAgb3ZlcmxheUVsZW1lbnQuaW5uZXJIVE1MID0gdGVtcGxhdGUuaW5uZXJIVE1MO1xuXG4gIGNvbnN0IGNsb3NlRWxlbWVudCA9IG92ZXJsYXlFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmV2aWV3c19fb3ZlcmxheS1jbG9zZVwiKTtcbiAgY2xvc2VFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdmVybGF5RWxlbWVudCk7XG4gIH0pO1xuICBjb25zdCBjb250ZW50TmFtZSA9IG92ZXJsYXlFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgXCIucmV2aWV3c19fb3ZlcmxheS1jb250ZW50X19uYW1lXCJcbiAgKTtcbiAgY29udGVudE5hbWUuaW5uZXJIVE1MID0gbmFtZTtcblxuICBjb25zdCBjb250ZW50VGV4dCA9IG92ZXJsYXlFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgXCIucmV2aWV3c19fb3ZlcmxheS1jb250ZW50X19kaXNjcmlwdGlvblwiXG4gICk7XG4gIGNvbnRlbnRUZXh0LmlubmVySFRNTCA9IHRleHQ7XG5cbiAgcmV0dXJuIG92ZXJsYXlFbGVtZW50O1xufVxuXG5jb25zdCBvcGVuQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5yZXZpZXdfX2J0bl9fbGlua1wiKTtcbmNvbnN0IGdldE5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJldmlld19fbmFtZVwiKTtcbmNvbnN0IGdldFRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJldmlld19fdGV4dFwiKTtcblxudmFyIG5hbWUgPSBnZXROYW1lLmlubmVySFRNTDtcblxub3BlbkJ0bi5mb3JFYWNoKGV2ZW5CdG4gPT4ge1xuICBldmVuQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHtcbiAgICB2YXIgdGFyZ2V0ID0gZS50YXJnZXQ7XG4gICAgLy8gdmFyIG5hbWUgPSBnZXRUZXh0LnByZXZpb3VzU2libGluZztcbiAgICB2YXIgZ2V0VGV4dCA9IHRhcmdldC5wcmV2aW91c1NpYmxpbmc7XG4gICAgdmFyIHRleHQgPSBnZXRUZXh0LnByZXZpb3VzU2libGluZy5pbm5lckhUTUw7XG4gICAgY29uc3Qgc3VjY2VzT3ZlcmxheSA9IGNyZWF0ZU92ZXJsYXkobmFtZSwgdGV4dCk7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzdWNjZXNPdmVybGF5KTtcbiAgfSk7XG59KTtcblxuLy8gLy8gLS1vbmUgcGFnZSBzY3JvbGwtLVxuXG5jb25zdCBzZWN0aW9ucyA9ICQoXCIuc2VjdGlvblwiKTtcbmNvbnN0IGRpc3BsYXkgPSAkKFwiLm1haW5jb250ZW50XCIpO1xubGV0IGluU2Nyb2xsID0gZmFsc2U7XG5jb25zdCBtb2JpbGVEZXRlY3QgPSBuZXcgTW9iaWxlRGV0ZWN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KTtcbmNvbnN0IGlzTW9iaWxlID0gbW9iaWxlRGV0ZWN0Lm1vYmlsZSgpO1xuXG5jb25zdCBzZXRBY3RpdmVNZW51SXRlbSA9IGl0ZW1FcSA9PiB7XG4gICQoXCIubmF2LXNpZGViYXJfX2l0ZW1cIilcbiAgICAuZXEoaXRlbUVxKVxuICAgIC5hZGRDbGFzcyhcIm5hdi1zaWRlYmFyX2l0ZW1faXMtYWN0aXZlXCIpXG4gICAgLnNpYmxpbmdzKClcbiAgICAucmVtb3ZlQ2xhc3MoXCJuYXYtc2lkZWJhcl9pdGVtX2lzLWFjdGl2ZVwiKTtcbn07XG5cbmNvbnN0IHBlcmZvcm1UcmFuc2l0aW9uID0gc2VjdGlvbkVxID0+IHtcbiAgY29uc3QgcG9zaXRpb24gPSBgJHstc2VjdGlvbkVxICogMTAwfSVgO1xuXG4gIGlmIChpblNjcm9sbCkgcmV0dXJuO1xuXG4gIGluU2Nyb2xsID0gdHJ1ZTtcblxuICBzZWN0aW9uc1xuICAgIC5lcShzZWN0aW9uRXEpXG4gICAgLmFkZENsYXNzKFwiaXMtYWN0aXZlXCIpXG4gICAgLnNpYmxpbmdzKClcbiAgICAucmVtb3ZlQ2xhc3MoXCJpcy1hY3RpdmVcIik7XG4gIGRpc3BsYXkuY3NzKHtcbiAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGVZKCR7cG9zaXRpb259KWAsXG4gICAgXCItd2Via2l0LXRyYW5zZm9ybVwiOiBgdHJhbnNsYXRlWSgke3Bvc2l0aW9ufSlgXG4gIH0pO1xuICBjb25zdCB0cmFuc2l0aW9uRHVyYXRpb24gPVxuICAgIHBhcnNlSW50KGRpc3BsYXkuY3NzKFwidHJhbnNpdGlvbi1kdXJhdGlvblwiKSkgKiAxMDAwOyAvLyB0aW1lIGluIG1zXG4gIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgIGluU2Nyb2xsID0gZmFsc2U7XG4gICAgc2V0QWN0aXZlTWVudUl0ZW0oc2VjdGlvbkVxKTtcbiAgfSwgdHJhbnNpdGlvbkR1cmF0aW9uICsgMzAwKTsgLy8gcGYgMzAwINC80YEg0L/RgNC+0YXQvtC00LjRgiDQuNC90LXRgNGG0LjRjyDQvNGL0YjQutC4XG59O1xuXG5jb25zdCBzY3JvbGxUb1NlY3Rpb24gPSBkaXJlY3Rpb24gPT4ge1xuICBjb25zdCBhY3RpdmVTZWN0aW9uID0gc2VjdGlvbnMuZmlsdGVyKFwiLmlzLWFjdGl2ZVwiKTtcbiAgY29uc3QgbmV4dFNlY3Rpb24gPSBhY3RpdmVTZWN0aW9uLm5leHQoKTtcbiAgY29uc3QgcHJldlNlY3Rpb24gPSBhY3RpdmVTZWN0aW9uLnByZXYoKTtcblxuICBpZiAoZGlyZWN0aW9uID09PSBcInVwXCIgJiYgcHJldlNlY3Rpb24ubGVuZ3RoKSB7XG4gICAgcGVyZm9ybVRyYW5zaXRpb24ocHJldlNlY3Rpb24uaW5kZXgoKSk7XG4gIH1cbiAgaWYgKGRpcmVjdGlvbiA9PT0gXCJkb3duXCIgJiYgbmV4dFNlY3Rpb24ubGVuZ3RoKSB7XG4gICAgcGVyZm9ybVRyYW5zaXRpb24obmV4dFNlY3Rpb24uaW5kZXgoKSk7XG4gIH1cbn07XG5cbiQoZG9jdW1lbnQpLm9uKHtcbiAgd2hlZWw6IGUgPT4ge1xuICAgIGNvbnN0IGRlbHRhWSA9IGUub3JpZ2luYWxFdmVudC5kZWx0YVk7XG4gICAgY29uc3QgZGlyZWN0aW9uID0gZGVsdGFZID4gMCA/IFwiZG93blwiIDogXCJ1cFwiO1xuXG4gICAgc2Nyb2xsVG9TZWN0aW9uKGRpcmVjdGlvbik7XG4gIH0sXG4gIGtleWRvd246IGUgPT4ge1xuICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7XG4gICAgICBjYXNlIDQwOlxuICAgICAgICBzY3JvbGxUb1NlY3Rpb24oXCJkb3duXCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzg6XG4gICAgICAgIHNjcm9sbFRvU2VjdGlvbihcInVwXCIpO1xuICAgICAgICBicmVhaztcblxuICAgICAgICBicmVhaztcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9LFxuICB0b3VjaG1vdmU6IGUgPT4gZS5wcmV2ZW50RGVmYXVsdCgpXG59KTtcblxuJChcIltkYXRhLXNjcm9sbC10b11cIikub24oXCJjbGlja1wiLCBlID0+IHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIGNvbnN0IHRhcmdldCA9IHBhcnNlSW50KCQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwiZGF0YS1zY3JvbGwtdG9cIikpO1xuICBwZXJmb3JtVHJhbnNpdGlvbih0YXJnZXQpO1xufSk7XG5cbmlmIChpc01vYmlsZSkge1xuICAkKGRvY3VtZW50KS5zd2lwZSh7XG4gICAgc3dpcGU6IGZ1bmN0aW9uKFxuICAgICAgZXZlbnQsXG4gICAgICBkaXJlY3Rpb24sXG4gICAgICBkaXN0YW5jZSxcbiAgICAgIGR1cmF0aW9uLFxuICAgICAgZmluZ2VyQ291bnQsXG4gICAgICBmaW5nZXJEYXRhXG4gICAgKSB7XG4gICAgICBjb25zdCBzd2lwZURpcmVjdGlvbiA9IGRpcmVjdGlvbiA9PT0gXCJkb3duXCIgPyBcInVwXCIgOiBcImRvd25cIjtcbiAgICAgIHNjcm9sbFRvU2VjdGlvbihzd2lwZURpcmVjdGlvbik7XG4gICAgfVxuICB9KTtcbn1cblxuLy8gRm9ybVxuXG4kKFwiI2Zvcm1cIikub24oXCJzdWJtaXRcIiwgc3VibWl0Rm9ybSk7XG5cbmZ1bmN0aW9uIHN1Ym1pdEZvcm0oZXYpIHtcbiAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgdmFyIGZvcm0gPSAkKGV2LnRhcmdldCk7XG4gIHJlcXVlc3QgPSBhamF4Rm9ybShmb3JtKTtcblxuICByZXF1ZXN0LmRvbmUoZnVuY3Rpb24obXNnKSB7XG4gICAgdmFyIG1lcyA9IG1zZy5tZXMsXG4gICAgICBzdGF0dXMgPSBtc2cuc3RhdHVzO1xuICAgIGlmIChzdGF0dXMgPT09IFwiT0tcIikge1xuICAgICAgZm9ybS5hcHBlbmQoJzxwIGNsYXNzPVwic3VjY2Vzc1wiPicgKyBtZXMgKyBcIjwvcD5cIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvcm0uYXBwZW5kKCc8cCBjbGFzcz1cImVycm9yXCI+JyArIG1lcyArIFwiPC9wPlwiKTtcbiAgICB9XG4gIH0pO1xuICByZXF1ZXN0LmZhaWwoZnVuY3Rpb24oanFYSFIsIHRleHRTdGF0dXMpIHtcbiAgICBhbGVydChcIlJlcXVlc3QgZmFpbGVkOiBcIiArIHRleHRTdGF0dXMpO1xuICB9KTtcbn1cbi8vIFVuaXZlcmNpdHkgZnVuY3Rpb24gZm9yIHdvcmsgd2l0aCBhbGwgZm9ybXNcbnZhciBhamF4Rm9ybSA9IGZ1bmN0aW9uKGZvcm0pIHtcbiAgdmFyIGRhdGEgPSBmb3JtLnNlcmlhbGl6ZSgpLFxuICAgIHVybCA9IGZvcm0uYXR0cihcImFjdGlvblwiKTtcbiAgcmV0dXJuICQuYWpheCh7XG4gICAgdHlwZTogXCJQT1NUXCIsXG4gICAgdXJsOiB1cmwsXG4gICAgZGF0YVR5cGU6IFwiSlNPTlwiLFxuICAgIGRhdGE6IGRhdGFcbiAgfSk7XG59O1xuXG4vL1lhbmRleCBtYXBcblxueW1hcHMucmVhZHkoaW5pdCk7XG5cbnZhciBwbGFjZW1hcmtzID0gW1xuICB7XG4gICAgbGF0aXR1ZGU6IDU5Ljk3LFxuICAgIGxvbmdpdHVkZTogMzAuMzEsXG4gICAgaGludENvbnRlbnQ6ICc8ZGl2IGNsYXNzPVwibWFwX19oaW50XCI+0YPQu9C40YbQsCDQm9C40YLQtdGA0LDQu9C+0LIg0LTQvtC8IDE5IDwvZGl2PicsXG4gICAgYmFsbG9vbkNvbnRlbnQ6IFtcbiAgICAgICc8ZGl2IGNsYXNzPVwibWFwX19iYWxsb29uXCI+JyxcbiAgICAgIFwi0KHQsNC80YvQtSDQstC60YPRgdC90YvQtSDQsdGD0YDQs9C10YDRiyDRgyDQvdCw0YEhINCX0LDRhdC+0LTQuNGC0LUg0L/QviDQsNC00YDQtdGB0YM6INGD0LsuINCb0LjRgtC10YDQsNC70L7Qsiwg0LQuIDE5XCIsXG4gICAgICBcIjwvZGl2PlwiXG4gICAgXVxuICB9LFxuICB7XG4gICAgbGF0aXR1ZGU6IDU5Ljk0LFxuICAgIGxvbmdpdHVkZTogMzAuMjUsXG4gICAgaGludENvbnRlbnQ6ICc8ZGl2IGNsYXNzPVwibWFwX19oaW50XCI+0JzQsNC70YvQuSDQv9GA0L7RgdC/0LXQutGCINCSINCeLCDQtCA2NDwvZGl2PicsXG4gICAgYmFsbG9vbkNvbnRlbnQ6IFtcbiAgICAgICc8ZGl2IGNsYXNzPVwibWFwX19iYWxsb29uXCI+JyxcbiAgICAgIFwi0KHQsNC80YvQtSDQstC60YPRgdC90YvQtSDQsdGD0YDQs9C10YDRiyDRgyDQvdCw0YEhINCX0LDRhdC+0LTQuNGC0LUg0L/QviDQsNC00YDQtdGB0YM6INCc0LDQu9GL0Lkg0L/RgNC+0YHQv9C10LrRgiDQkiDQniwg0LQgNjRcIixcbiAgICAgIFwiPC9kaXY+XCJcbiAgICBdXG4gIH0sXG4gIHtcbiAgICBsYXRpdHVkZTogNTkuOTMsXG4gICAgbG9uZ2l0dWRlOiAzMC4zNCxcbiAgICBoaW50Q29udGVudDogJzxkaXYgY2xhc3M9XCJtYXBfX2hpbnRcIj7QvdCw0LEuINGA0LXQutC4INCk0L7QvdGC0LDQvdC60LjQkSDQtCA1NiA8L2Rpdj4nLFxuICAgIGJhbGxvb25Db250ZW50OiBbXG4gICAgICAnPGRpdiBjbGFzcz1cIm1hcF9fYmFsbG9vblwiPicsXG4gICAgICBcItCh0LDQvNGL0LUg0LLQutGD0YHQvdGL0LUg0LHRg9GA0LPQtdGA0Ysg0YMg0L3QsNGBISDQl9Cw0YXQvtC00LjRgtC1INC/0L4g0LDQtNGA0LXRgdGDOiDQvdCw0LEuINGA0LXQutC4INCk0L7QvdGC0LDQvdC60LjQkSDQtCA1NlwiLFxuICAgICAgXCI8L2Rpdj5cIlxuICAgIF1cbiAgfVxuXTtcblxuZnVuY3Rpb24gaW5pdCgpIHtcbiAgdmFyIG1hcCA9IG5ldyB5bWFwcy5NYXAoXCJtYXBcIiwge1xuICAgIGNlbnRlcjogWzU5Ljk0LCAzMC4zMl0sXG4gICAgem9vbTogMTIsXG4gICAgY29udHJvbHM6IFtcInpvb21Db250cm9sXCJdLFxuICAgIGJlaGF2aW9yczogW1wiZHJhZ1wiXVxuICB9KTtcblxuICBwbGFjZW1hcmtzLmZvckVhY2goZnVuY3Rpb24ob2JqKSB7XG4gICAgdmFyIHBsYWNlbWFyayA9IG5ldyB5bWFwcy5QbGFjZW1hcmsoXG4gICAgICBbb2JqLmxhdGl0dWRlLCBvYmoubG9uZ2l0dWRlXSxcbiAgICAgIHtcbiAgICAgICAgaGludENvbnRlbnQ6IG9iai5oaW50Q29udGVudCxcbiAgICAgICAgYmFsbG9vbkNvbnRlbnQ6IG9iai5iYWxsb29uQ29udGVudC5qb2luKFwiXCIpXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBpY29uTGF5b3V0OiBcImRlZmF1bHQjaW1hZ2VcIixcbiAgICAgICAgaWNvbkltYWdlSHJlZjogXCIuLi9pbWcvbWFwL2ljb25fX3BvaW50L21hcC1tYXJrZXIuc3ZnXCIsXG4gICAgICAgIGljb25JbWFnZVNpemU6IFs0NiwgNTddLFxuICAgICAgICBpY29uSW1hZ2VPZmZzZXQ6IFstMjMsIC01N11cbiAgICAgIH1cbiAgICApO1xuICAgIG1hcC5nZW9PYmplY3RzLmFkZChwbGFjZW1hcmspO1xuICB9KTtcbiAgdmFyIGNsdXN0ZXJlciA9IG5ldyB5bWFwcy5DbHVzdGVyZXIoe30pO1xuICBtYXAuZ2VvT2JqZWN0cy5hZGQoY2x1c3RlcmVyKTtcbn1cbiJdfQ==
