// VARIABLES
// adjustment
const btn__close = document.querySelector(".btn__close"); // using in --pop up--, --  --
// section --do--
// --pop up--
const sidebar__mobile = document.querySelector(".nav-sidebar__mobile");
const transfer__menu = document.querySelector(".mobile__transfer__menu");
const menu__link = document.querySelectorAll(".transfer_item_link");

sidebar__mobile.addEventListener("click", e => {
  e.preventDefault();
  transfer__menu.style.top = "0px";
});
btn__close.addEventListener("click", e => {
  transfer__menu.style.top = "-9999px";
});
menu__link.forEach(link => {
  link.addEventListener("click", e => {
    e.preventDefault();
    transfer__menu.style.top = "-9999px";
  });
});

// burger --slider--
$(function() {
  var coloringDots = function(index) {
    $(".burger-slider")
      .find(".bottom__dots-item")
      .eq(index)
      .addClass("active_dot")
      .siblings()
      .removeClass("active_dot");
  };

  var generateDots = function() {
    $(".burger__carousel").each(function() {
      var dot = $("<li>", {
        attr: {
          class: "bottom__dots-item"
        },
        html: '<div class="bottom__dots-item__circle"></div>'
      });
      $(".bottom__dots-list").append(dot);
    });
  };

  generateDots();

  var moveSlide = function(container, slideNum) {
    var items = container.find(".burger__carousel"),
      activeSlide = items.filter(".burger_is-active");
    (reqItem = items.eq(slideNum)),
      (reqIndex = reqItem.index()),
      (list = container.find(".burger__carousel-list")),
      (duration = 500);

    if (reqItem.length) {
      list.animate(
        {
          left: -reqIndex * 100 + "%"
        },
        duration,
        function() {
          activeSlide.removeClass("burger_is-active");
          reqItem.addClass("burger_is-active");
          coloringDots(slideNum);
        }
      );
    }
  };

  $(".slider__btn").on("click", function(e) {
    e.preventDefault();

    var $this = $(this),
      container = $this.closest(".burger-slider"),
      items = $(".burger__carousel", container),
      activeItem = items.filter(".burger_is-active"),
      existedItem,
      edgeItem,
      reqItem;

    if ($this.hasClass("slider_btn_next")) {
      // вперед
      existedItem = activeItem.next();
      edgeItem = items.first();
    }
    if ($this.hasClass("slider_btn_prev")) {
      //назад
      existedItem = activeItem.prev();
      edgeItem = items.last();
    }
    reqItem = existedItem.length ? existedItem.index() : edgeItem.index();

    moveSlide(container, reqItem);
  });

  $("body").on("click", ".bottom__dots-item", function() {
    var $this = $(this),
      container = $this.closest(".burger-slider"),
      index = $this.index();
    moveSlide(container, index);
    coloringDots(index);
  });
});

// burger --ingridients--
const btnIngridients = document.querySelector(".block__float-ingridients");
const floatIngridients = document.querySelector(".float-ingridients__list");
const burger__container = document.querySelector(".burger-container");

btnIngridients.addEventListener("mousemove", e => {
  floatIngridients.style.opacity = "1";
  floatIngridients.style.left = "100%";
});

burger__container.addEventListener("mouseover", e => {
  floatIngridients.style.opacity = "0";
  floatIngridients.style.left = "-9999px";
});

// section --Team--
const team__item = document.querySelectorAll(".team__accordeon__item");
const items = document.querySelector(".team__accordeon__list");
const team__section = document.querySelector(".team");

items.addEventListener("click", e => {
  e.preventDefault();
  let target = e.target;

  if (target.className === "team__accordeon__link") {
    let item = target.closest(".team__accordeon__item");
    if (item.classList.contains("team_accordeon_item_active")) {
      item.classList.toggle("team_accordeon_item_active");
    } else {
      team__item.forEach(function(item, index) {
        item.classList.remove("team_accordeon_item_active");
      });
      item.classList.add("team_accordeon_item_active");
    }
  }
});
// section --menu--

const menuList = document.querySelector(".menu__accordeon__list");
const menuItem = document.querySelectorAll(".menu__accordeon__item");

menuList.addEventListener("click", e => {
  e.preventDefault();
  let target = e.target;
  if (target.className === "menu__accordeon__link__title") {
    let closestMenuItem = target.closest(".menu__accordeon__item");
    if (closestMenuItem.classList.contains("menu_accordeon_item_active")) {
      closestMenuItem.classList.toggle("menu_accordeon_item_active");
    } else {
      menuItem.forEach(function(closestMenuItem, index) {
        closestMenuItem.classList.remove("menu_accordeon_item_active");
      });
      closestMenuItem.classList.add("menu_accordeon_item_active");
    }
  }
});

function createOverlay(name, text) {
  const overlayElement = document.createElement("div");
  overlayElement.classList.add("reviews__overlay");

  const template = document.querySelector("#overlayReviews");
  overlayElement.innerHTML = template.innerHTML;

  const closeElement = overlayElement.querySelector(".reviews__overlay-close");
  closeElement.addEventListener("click", e => {
    e.preventDefault();
    document.body.removeChild(overlayElement);
  });
  const contentName = overlayElement.querySelector(
    ".reviews__overlay-content__name"
  );
  contentName.innerHTML = name;

  const contentText = overlayElement.querySelector(
    ".reviews__overlay-content__discription"
  );
  contentText.innerHTML = text;

  return overlayElement;
}

const openBtn = document.querySelectorAll(".review__btn__link");
const getName = document.querySelector(".review__name");
const getText = document.querySelector(".review__text");

var name = getName.innerHTML;

openBtn.forEach(evenBtn => {
  evenBtn.addEventListener("click", e => {
    var target = e.target;
    // var name = getText.previousSibling;
    var getText = target.previousSibling;
    var text = getText.previousSibling.innerHTML;
    const succesOverlay = createOverlay(name, text);
    document.body.appendChild(succesOverlay);
  });
});

// // --one page scroll--

const sections = $(".section");
const display = $(".maincontent");
let inScroll = false;
const mobileDetect = new MobileDetect(window.navigator.userAgent);
const isMobile = mobileDetect.mobile();

const setActiveMenuItem = itemEq => {
  $(".nav-sidebar__item")
    .eq(itemEq)
    .addClass("nav-sidebar_item_is-active")
    .siblings()
    .removeClass("nav-sidebar_item_is-active");
};

const performTransition = sectionEq => {
  const position = `${-sectionEq * 100}%`;

  if (inScroll) return;

  inScroll = true;

  sections
    .eq(sectionEq)
    .addClass("is-active")
    .siblings()
    .removeClass("is-active");
  display.css({
    transform: `translateY(${position})`,
    "-webkit-transform": `translateY(${position})`
  });
  const transitionDuration =
    parseInt(display.css("transition-duration")) * 1000; // time in ms
  setTimeout(() => {
    inScroll = false;
    setActiveMenuItem(sectionEq);
  }, transitionDuration + 300); // pf 300 мс проходит инерция мышки
};

const scrollToSection = direction => {
  const activeSection = sections.filter(".is-active");
  const nextSection = activeSection.next();
  const prevSection = activeSection.prev();

  if (direction === "up" && prevSection.length) {
    performTransition(prevSection.index());
  }
  if (direction === "down" && nextSection.length) {
    performTransition(nextSection.index());
  }
};

$(document).on({
  wheel: e => {
    const deltaY = e.originalEvent.deltaY;
    const direction = deltaY > 0 ? "down" : "up";

    scrollToSection(direction);
  },
  keydown: e => {
    switch (e.keyCode) {
      case 40:
        scrollToSection("down");
        break;
      case 38:
        scrollToSection("up");
        break;

        break;

      default:
        break;
    }
  },
  touchmove: e => e.preventDefault()
});

$("[data-scroll-to]").on("click", e => {
  e.preventDefault();

  const target = parseInt($(e.currentTarget).attr("data-scroll-to"));
  performTransition(target);
});

if (isMobile) {
  $(document).swipe({
    swipe: function(
      event,
      direction,
      distance,
      duration,
      fingerCount,
      fingerData
    ) {
      const swipeDirection = direction === "down" ? "up" : "down";
      scrollToSection(swipeDirection);
    }
  });
}

// Form

$("#form").on("submit", submitForm);

function submitForm(ev) {
  ev.preventDefault();
  var form = $(ev.target);
  request = ajaxForm(form);

  request.done(function(msg) {
    var mes = msg.mes,
      status = msg.status;
    if (status === "OK") {
      form.append('<p class="success">' + mes + "</p>");
    } else {
      form.append('<p class="error">' + mes + "</p>");
    }
  });
  request.fail(function(jqXHR, textStatus) {
    alert("Request failed: " + textStatus);
  });
}
// Univercity function for work with all forms
var ajaxForm = function(form) {
  var data = form.serialize(),
    url = form.attr("action");
  return $.ajax({
    type: "POST",
    url: url,
    dataType: "JSON",
    data: data
  });
};

//Yandex map

ymaps.ready(init);

var placemarks = [
  {
    latitude: 59.97,
    longitude: 30.31,
    hintContent: '<div class="map__hint">улица Литералов дом 19 </div>',
    balloonContent: [
      '<div class="map__balloon">',
      "Самые вкусные бургеры у нас! Заходите по адресу: ул. Литералов, д. 19",
      "</div>"
    ]
  },
  {
    latitude: 59.94,
    longitude: 30.25,
    hintContent: '<div class="map__hint">Малый проспект В О, д 64</div>',
    balloonContent: [
      '<div class="map__balloon">',
      "Самые вкусные бургеры у нас! Заходите по адресу: Малый проспект В О, д 64",
      "</div>"
    ]
  },
  {
    latitude: 59.93,
    longitude: 30.34,
    hintContent: '<div class="map__hint">наб. реки ФонтанкиБ д 56 </div>',
    balloonContent: [
      '<div class="map__balloon">',
      "Самые вкусные бургеры у нас! Заходите по адресу: наб. реки ФонтанкиБ д 56",
      "</div>"
    ]
  }
];

function init() {
  var map = new ymaps.Map("map", {
    center: [59.94, 30.32],
    zoom: 12,
    controls: ["zoomControl"],
    behaviors: ["drag"]
  });

  placemarks.forEach(function(obj) {
    var placemark = new ymaps.Placemark(
      [obj.latitude, obj.longitude],
      {
        hintContent: obj.hintContent,
        balloonContent: obj.balloonContent.join("")
      },
      {
        iconLayout: "default#image",
        iconImageHref: "../img/map/icon__point/map-marker.svg",
        iconImageSize: [46, 57],
        iconImageOffset: [-23, -57]
      }
    );
    map.geoObjects.add(placemark);
  });
  var clusterer = new ymaps.Clusterer({});
  map.geoObjects.add(clusterer);
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIFZBUklBQkxFU1xuLy8gYWRqdXN0bWVudFxuY29uc3QgYnRuX19jbG9zZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYnRuX19jbG9zZVwiKTsgLy8gdXNpbmcgaW4gLS1wb3AgdXAtLSwgLS0gIC0tXG4vLyBzZWN0aW9uIC0tZG8tLVxuLy8gLS1wb3AgdXAtLVxuY29uc3Qgc2lkZWJhcl9fbW9iaWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5uYXYtc2lkZWJhcl9fbW9iaWxlXCIpO1xuY29uc3QgdHJhbnNmZXJfX21lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vYmlsZV9fdHJhbnNmZXJfX21lbnVcIik7XG5jb25zdCBtZW51X19saW5rID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi50cmFuc2Zlcl9pdGVtX2xpbmtcIik7XG5cbnNpZGViYXJfX21vYmlsZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcbiAgdHJhbnNmZXJfX21lbnUuc3R5bGUudG9wID0gXCIwcHhcIjtcbn0pO1xuYnRuX19jbG9zZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB7XG4gIHRyYW5zZmVyX19tZW51LnN0eWxlLnRvcCA9IFwiLTk5OTlweFwiO1xufSk7XG5tZW51X19saW5rLmZvckVhY2gobGluayA9PiB7XG4gIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGUgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB0cmFuc2Zlcl9fbWVudS5zdHlsZS50b3AgPSBcIi05OTk5cHhcIjtcbiAgfSk7XG59KTtcblxuLy8gYnVyZ2VyIC0tc2xpZGVyLS1cbiQoZnVuY3Rpb24oKSB7XG4gIHZhciBjb2xvcmluZ0RvdHMgPSBmdW5jdGlvbihpbmRleCkge1xuICAgICQoXCIuYnVyZ2VyLXNsaWRlclwiKVxuICAgICAgLmZpbmQoXCIuYm90dG9tX19kb3RzLWl0ZW1cIilcbiAgICAgIC5lcShpbmRleClcbiAgICAgIC5hZGRDbGFzcyhcImFjdGl2ZV9kb3RcIilcbiAgICAgIC5zaWJsaW5ncygpXG4gICAgICAucmVtb3ZlQ2xhc3MoXCJhY3RpdmVfZG90XCIpO1xuICB9O1xuXG4gIHZhciBnZW5lcmF0ZURvdHMgPSBmdW5jdGlvbigpIHtcbiAgICAkKFwiLmJ1cmdlcl9fY2Fyb3VzZWxcIikuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgIHZhciBkb3QgPSAkKFwiPGxpPlwiLCB7XG4gICAgICAgIGF0dHI6IHtcbiAgICAgICAgICBjbGFzczogXCJib3R0b21fX2RvdHMtaXRlbVwiXG4gICAgICAgIH0sXG4gICAgICAgIGh0bWw6ICc8ZGl2IGNsYXNzPVwiYm90dG9tX19kb3RzLWl0ZW1fX2NpcmNsZVwiPjwvZGl2PidcbiAgICAgIH0pO1xuICAgICAgJChcIi5ib3R0b21fX2RvdHMtbGlzdFwiKS5hcHBlbmQoZG90KTtcbiAgICB9KTtcbiAgfTtcblxuICBnZW5lcmF0ZURvdHMoKTtcblxuICB2YXIgbW92ZVNsaWRlID0gZnVuY3Rpb24oY29udGFpbmVyLCBzbGlkZU51bSkge1xuICAgIHZhciBpdGVtcyA9IGNvbnRhaW5lci5maW5kKFwiLmJ1cmdlcl9fY2Fyb3VzZWxcIiksXG4gICAgICBhY3RpdmVTbGlkZSA9IGl0ZW1zLmZpbHRlcihcIi5idXJnZXJfaXMtYWN0aXZlXCIpO1xuICAgIChyZXFJdGVtID0gaXRlbXMuZXEoc2xpZGVOdW0pKSxcbiAgICAgIChyZXFJbmRleCA9IHJlcUl0ZW0uaW5kZXgoKSksXG4gICAgICAobGlzdCA9IGNvbnRhaW5lci5maW5kKFwiLmJ1cmdlcl9fY2Fyb3VzZWwtbGlzdFwiKSksXG4gICAgICAoZHVyYXRpb24gPSA1MDApO1xuXG4gICAgaWYgKHJlcUl0ZW0ubGVuZ3RoKSB7XG4gICAgICBsaXN0LmFuaW1hdGUoXG4gICAgICAgIHtcbiAgICAgICAgICBsZWZ0OiAtcmVxSW5kZXggKiAxMDAgKyBcIiVcIlxuICAgICAgICB9LFxuICAgICAgICBkdXJhdGlvbixcbiAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgYWN0aXZlU2xpZGUucmVtb3ZlQ2xhc3MoXCJidXJnZXJfaXMtYWN0aXZlXCIpO1xuICAgICAgICAgIHJlcUl0ZW0uYWRkQ2xhc3MoXCJidXJnZXJfaXMtYWN0aXZlXCIpO1xuICAgICAgICAgIGNvbG9yaW5nRG90cyhzbGlkZU51bSk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfVxuICB9O1xuXG4gICQoXCIuc2xpZGVyX19idG5cIikub24oXCJjbGlja1wiLCBmdW5jdGlvbihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgdmFyICR0aGlzID0gJCh0aGlzKSxcbiAgICAgIGNvbnRhaW5lciA9ICR0aGlzLmNsb3Nlc3QoXCIuYnVyZ2VyLXNsaWRlclwiKSxcbiAgICAgIGl0ZW1zID0gJChcIi5idXJnZXJfX2Nhcm91c2VsXCIsIGNvbnRhaW5lciksXG4gICAgICBhY3RpdmVJdGVtID0gaXRlbXMuZmlsdGVyKFwiLmJ1cmdlcl9pcy1hY3RpdmVcIiksXG4gICAgICBleGlzdGVkSXRlbSxcbiAgICAgIGVkZ2VJdGVtLFxuICAgICAgcmVxSXRlbTtcblxuICAgIGlmICgkdGhpcy5oYXNDbGFzcyhcInNsaWRlcl9idG5fbmV4dFwiKSkge1xuICAgICAgLy8g0LLQv9C10YDQtdC0XG4gICAgICBleGlzdGVkSXRlbSA9IGFjdGl2ZUl0ZW0ubmV4dCgpO1xuICAgICAgZWRnZUl0ZW0gPSBpdGVtcy5maXJzdCgpO1xuICAgIH1cbiAgICBpZiAoJHRoaXMuaGFzQ2xhc3MoXCJzbGlkZXJfYnRuX3ByZXZcIikpIHtcbiAgICAgIC8v0L3QsNC30LDQtFxuICAgICAgZXhpc3RlZEl0ZW0gPSBhY3RpdmVJdGVtLnByZXYoKTtcbiAgICAgIGVkZ2VJdGVtID0gaXRlbXMubGFzdCgpO1xuICAgIH1cbiAgICByZXFJdGVtID0gZXhpc3RlZEl0ZW0ubGVuZ3RoID8gZXhpc3RlZEl0ZW0uaW5kZXgoKSA6IGVkZ2VJdGVtLmluZGV4KCk7XG5cbiAgICBtb3ZlU2xpZGUoY29udGFpbmVyLCByZXFJdGVtKTtcbiAgfSk7XG5cbiAgJChcImJvZHlcIikub24oXCJjbGlja1wiLCBcIi5ib3R0b21fX2RvdHMtaXRlbVwiLCBmdW5jdGlvbigpIHtcbiAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLFxuICAgICAgY29udGFpbmVyID0gJHRoaXMuY2xvc2VzdChcIi5idXJnZXItc2xpZGVyXCIpLFxuICAgICAgaW5kZXggPSAkdGhpcy5pbmRleCgpO1xuICAgIG1vdmVTbGlkZShjb250YWluZXIsIGluZGV4KTtcbiAgICBjb2xvcmluZ0RvdHMoaW5kZXgpO1xuICB9KTtcbn0pO1xuXG4vLyBidXJnZXIgLS1pbmdyaWRpZW50cy0tXG5jb25zdCBidG5JbmdyaWRpZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYmxvY2tfX2Zsb2F0LWluZ3JpZGllbnRzXCIpO1xuY29uc3QgZmxvYXRJbmdyaWRpZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZmxvYXQtaW5ncmlkaWVudHNfX2xpc3RcIik7XG5jb25zdCBidXJnZXJfX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYnVyZ2VyLWNvbnRhaW5lclwiKTtcblxuYnRuSW5ncmlkaWVudHMuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBlID0+IHtcbiAgZmxvYXRJbmdyaWRpZW50cy5zdHlsZS5vcGFjaXR5ID0gXCIxXCI7XG4gIGZsb2F0SW5ncmlkaWVudHMuc3R5bGUubGVmdCA9IFwiMTAwJVwiO1xufSk7XG5cbmJ1cmdlcl9fY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW92ZXJcIiwgZSA9PiB7XG4gIGZsb2F0SW5ncmlkaWVudHMuc3R5bGUub3BhY2l0eSA9IFwiMFwiO1xuICBmbG9hdEluZ3JpZGllbnRzLnN0eWxlLmxlZnQgPSBcIi05OTk5cHhcIjtcbn0pO1xuXG4vLyBzZWN0aW9uIC0tVGVhbS0tXG5jb25zdCB0ZWFtX19pdGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi50ZWFtX19hY2NvcmRlb25fX2l0ZW1cIik7XG5jb25zdCBpdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGVhbV9fYWNjb3JkZW9uX19saXN0XCIpO1xuY29uc3QgdGVhbV9fc2VjdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGVhbVwiKTtcblxuaXRlbXMuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGUgPT4ge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIGxldCB0YXJnZXQgPSBlLnRhcmdldDtcblxuICBpZiAodGFyZ2V0LmNsYXNzTmFtZSA9PT0gXCJ0ZWFtX19hY2NvcmRlb25fX2xpbmtcIikge1xuICAgIGxldCBpdGVtID0gdGFyZ2V0LmNsb3Nlc3QoXCIudGVhbV9fYWNjb3JkZW9uX19pdGVtXCIpO1xuICAgIGlmIChpdGVtLmNsYXNzTGlzdC5jb250YWlucyhcInRlYW1fYWNjb3JkZW9uX2l0ZW1fYWN0aXZlXCIpKSB7XG4gICAgICBpdGVtLmNsYXNzTGlzdC50b2dnbGUoXCJ0ZWFtX2FjY29yZGVvbl9pdGVtX2FjdGl2ZVwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGVhbV9faXRlbS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0sIGluZGV4KSB7XG4gICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZShcInRlYW1fYWNjb3JkZW9uX2l0ZW1fYWN0aXZlXCIpO1xuICAgICAgfSk7XG4gICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoXCJ0ZWFtX2FjY29yZGVvbl9pdGVtX2FjdGl2ZVwiKTtcbiAgICB9XG4gIH1cbn0pO1xuLy8gc2VjdGlvbiAtLW1lbnUtLVxuXG5jb25zdCBtZW51TGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubWVudV9fYWNjb3JkZW9uX19saXN0XCIpO1xuY29uc3QgbWVudUl0ZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1lbnVfX2FjY29yZGVvbl9faXRlbVwiKTtcblxubWVudUxpc3QuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGUgPT4ge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIGxldCB0YXJnZXQgPSBlLnRhcmdldDtcbiAgaWYgKHRhcmdldC5jbGFzc05hbWUgPT09IFwibWVudV9fYWNjb3JkZW9uX19saW5rX190aXRsZVwiKSB7XG4gICAgbGV0IGNsb3Nlc3RNZW51SXRlbSA9IHRhcmdldC5jbG9zZXN0KFwiLm1lbnVfX2FjY29yZGVvbl9faXRlbVwiKTtcbiAgICBpZiAoY2xvc2VzdE1lbnVJdGVtLmNsYXNzTGlzdC5jb250YWlucyhcIm1lbnVfYWNjb3JkZW9uX2l0ZW1fYWN0aXZlXCIpKSB7XG4gICAgICBjbG9zZXN0TWVudUl0ZW0uY2xhc3NMaXN0LnRvZ2dsZShcIm1lbnVfYWNjb3JkZW9uX2l0ZW1fYWN0aXZlXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBtZW51SXRlbS5mb3JFYWNoKGZ1bmN0aW9uKGNsb3Nlc3RNZW51SXRlbSwgaW5kZXgpIHtcbiAgICAgICAgY2xvc2VzdE1lbnVJdGVtLmNsYXNzTGlzdC5yZW1vdmUoXCJtZW51X2FjY29yZGVvbl9pdGVtX2FjdGl2ZVwiKTtcbiAgICAgIH0pO1xuICAgICAgY2xvc2VzdE1lbnVJdGVtLmNsYXNzTGlzdC5hZGQoXCJtZW51X2FjY29yZGVvbl9pdGVtX2FjdGl2ZVwiKTtcbiAgICB9XG4gIH1cbn0pO1xuXG5mdW5jdGlvbiBjcmVhdGVPdmVybGF5KG5hbWUsIHRleHQpIHtcbiAgY29uc3Qgb3ZlcmxheUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBvdmVybGF5RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwicmV2aWV3c19fb3ZlcmxheVwiKTtcblxuICBjb25zdCB0ZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjb3ZlcmxheVJldmlld3NcIik7XG4gIG92ZXJsYXlFbGVtZW50LmlubmVySFRNTCA9IHRlbXBsYXRlLmlubmVySFRNTDtcblxuICBjb25zdCBjbG9zZUVsZW1lbnQgPSBvdmVybGF5RWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnJldmlld3NfX292ZXJsYXktY2xvc2VcIik7XG4gIGNsb3NlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheUVsZW1lbnQpO1xuICB9KTtcbiAgY29uc3QgY29udGVudE5hbWUgPSBvdmVybGF5RWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgIFwiLnJldmlld3NfX292ZXJsYXktY29udGVudF9fbmFtZVwiXG4gICk7XG4gIGNvbnRlbnROYW1lLmlubmVySFRNTCA9IG5hbWU7XG5cbiAgY29uc3QgY29udGVudFRleHQgPSBvdmVybGF5RWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgIFwiLnJldmlld3NfX292ZXJsYXktY29udGVudF9fZGlzY3JpcHRpb25cIlxuICApO1xuICBjb250ZW50VGV4dC5pbm5lckhUTUwgPSB0ZXh0O1xuXG4gIHJldHVybiBvdmVybGF5RWxlbWVudDtcbn1cblxuY29uc3Qgb3BlbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucmV2aWV3X19idG5fX2xpbmtcIik7XG5jb25zdCBnZXROYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXZpZXdfX25hbWVcIik7XG5jb25zdCBnZXRUZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXZpZXdfX3RleHRcIik7XG5cbnZhciBuYW1lID0gZ2V0TmFtZS5pbm5lckhUTUw7XG5cbm9wZW5CdG4uZm9yRWFjaChldmVuQnRuID0+IHtcbiAgZXZlbkJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB7XG4gICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0O1xuICAgIC8vIHZhciBuYW1lID0gZ2V0VGV4dC5wcmV2aW91c1NpYmxpbmc7XG4gICAgdmFyIGdldFRleHQgPSB0YXJnZXQucHJldmlvdXNTaWJsaW5nO1xuICAgIHZhciB0ZXh0ID0gZ2V0VGV4dC5wcmV2aW91c1NpYmxpbmcuaW5uZXJIVE1MO1xuICAgIGNvbnN0IHN1Y2Nlc092ZXJsYXkgPSBjcmVhdGVPdmVybGF5KG5hbWUsIHRleHQpO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc3VjY2VzT3ZlcmxheSk7XG4gIH0pO1xufSk7XG5cbi8vIC8vIC0tb25lIHBhZ2Ugc2Nyb2xsLS1cblxuY29uc3Qgc2VjdGlvbnMgPSAkKFwiLnNlY3Rpb25cIik7XG5jb25zdCBkaXNwbGF5ID0gJChcIi5tYWluY29udGVudFwiKTtcbmxldCBpblNjcm9sbCA9IGZhbHNlO1xuY29uc3QgbW9iaWxlRGV0ZWN0ID0gbmV3IE1vYmlsZURldGVjdCh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCk7XG5jb25zdCBpc01vYmlsZSA9IG1vYmlsZURldGVjdC5tb2JpbGUoKTtcblxuY29uc3Qgc2V0QWN0aXZlTWVudUl0ZW0gPSBpdGVtRXEgPT4ge1xuICAkKFwiLm5hdi1zaWRlYmFyX19pdGVtXCIpXG4gICAgLmVxKGl0ZW1FcSlcbiAgICAuYWRkQ2xhc3MoXCJuYXYtc2lkZWJhcl9pdGVtX2lzLWFjdGl2ZVwiKVxuICAgIC5zaWJsaW5ncygpXG4gICAgLnJlbW92ZUNsYXNzKFwibmF2LXNpZGViYXJfaXRlbV9pcy1hY3RpdmVcIik7XG59O1xuXG5jb25zdCBwZXJmb3JtVHJhbnNpdGlvbiA9IHNlY3Rpb25FcSA9PiB7XG4gIGNvbnN0IHBvc2l0aW9uID0gYCR7LXNlY3Rpb25FcSAqIDEwMH0lYDtcblxuICBpZiAoaW5TY3JvbGwpIHJldHVybjtcblxuICBpblNjcm9sbCA9IHRydWU7XG5cbiAgc2VjdGlvbnNcbiAgICAuZXEoc2VjdGlvbkVxKVxuICAgIC5hZGRDbGFzcyhcImlzLWFjdGl2ZVwiKVxuICAgIC5zaWJsaW5ncygpXG4gICAgLnJlbW92ZUNsYXNzKFwiaXMtYWN0aXZlXCIpO1xuICBkaXNwbGF5LmNzcyh7XG4gICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlWSgke3Bvc2l0aW9ufSlgLFxuICAgIFwiLXdlYmtpdC10cmFuc2Zvcm1cIjogYHRyYW5zbGF0ZVkoJHtwb3NpdGlvbn0pYFxuICB9KTtcbiAgY29uc3QgdHJhbnNpdGlvbkR1cmF0aW9uID1cbiAgICBwYXJzZUludChkaXNwbGF5LmNzcyhcInRyYW5zaXRpb24tZHVyYXRpb25cIikpICogMTAwMDsgLy8gdGltZSBpbiBtc1xuICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICBpblNjcm9sbCA9IGZhbHNlO1xuICAgIHNldEFjdGl2ZU1lbnVJdGVtKHNlY3Rpb25FcSk7XG4gIH0sIHRyYW5zaXRpb25EdXJhdGlvbiArIDMwMCk7IC8vIHBmIDMwMCDQvNGBINC/0YDQvtGF0L7QtNC40YIg0LjQvdC10YDRhtC40Y8g0LzRi9GI0LrQuFxufTtcblxuY29uc3Qgc2Nyb2xsVG9TZWN0aW9uID0gZGlyZWN0aW9uID0+IHtcbiAgY29uc3QgYWN0aXZlU2VjdGlvbiA9IHNlY3Rpb25zLmZpbHRlcihcIi5pcy1hY3RpdmVcIik7XG4gIGNvbnN0IG5leHRTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5uZXh0KCk7XG4gIGNvbnN0IHByZXZTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5wcmV2KCk7XG5cbiAgaWYgKGRpcmVjdGlvbiA9PT0gXCJ1cFwiICYmIHByZXZTZWN0aW9uLmxlbmd0aCkge1xuICAgIHBlcmZvcm1UcmFuc2l0aW9uKHByZXZTZWN0aW9uLmluZGV4KCkpO1xuICB9XG4gIGlmIChkaXJlY3Rpb24gPT09IFwiZG93blwiICYmIG5leHRTZWN0aW9uLmxlbmd0aCkge1xuICAgIHBlcmZvcm1UcmFuc2l0aW9uKG5leHRTZWN0aW9uLmluZGV4KCkpO1xuICB9XG59O1xuXG4kKGRvY3VtZW50KS5vbih7XG4gIHdoZWVsOiBlID0+IHtcbiAgICBjb25zdCBkZWx0YVkgPSBlLm9yaWdpbmFsRXZlbnQuZGVsdGFZO1xuICAgIGNvbnN0IGRpcmVjdGlvbiA9IGRlbHRhWSA+IDAgPyBcImRvd25cIiA6IFwidXBcIjtcblxuICAgIHNjcm9sbFRvU2VjdGlvbihkaXJlY3Rpb24pO1xuICB9LFxuICBrZXlkb3duOiBlID0+IHtcbiAgICBzd2l0Y2ggKGUua2V5Q29kZSkge1xuICAgICAgY2FzZSA0MDpcbiAgICAgICAgc2Nyb2xsVG9TZWN0aW9uKFwiZG93blwiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM4OlxuICAgICAgICBzY3JvbGxUb1NlY3Rpb24oXCJ1cFwiKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfSxcbiAgdG91Y2htb3ZlOiBlID0+IGUucHJldmVudERlZmF1bHQoKVxufSk7XG5cbiQoXCJbZGF0YS1zY3JvbGwtdG9dXCIpLm9uKFwiY2xpY2tcIiwgZSA9PiB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcblxuICBjb25zdCB0YXJnZXQgPSBwYXJzZUludCgkKGUuY3VycmVudFRhcmdldCkuYXR0cihcImRhdGEtc2Nyb2xsLXRvXCIpKTtcbiAgcGVyZm9ybVRyYW5zaXRpb24odGFyZ2V0KTtcbn0pO1xuXG5pZiAoaXNNb2JpbGUpIHtcbiAgJChkb2N1bWVudCkuc3dpcGUoe1xuICAgIHN3aXBlOiBmdW5jdGlvbihcbiAgICAgIGV2ZW50LFxuICAgICAgZGlyZWN0aW9uLFxuICAgICAgZGlzdGFuY2UsXG4gICAgICBkdXJhdGlvbixcbiAgICAgIGZpbmdlckNvdW50LFxuICAgICAgZmluZ2VyRGF0YVxuICAgICkge1xuICAgICAgY29uc3Qgc3dpcGVEaXJlY3Rpb24gPSBkaXJlY3Rpb24gPT09IFwiZG93blwiID8gXCJ1cFwiIDogXCJkb3duXCI7XG4gICAgICBzY3JvbGxUb1NlY3Rpb24oc3dpcGVEaXJlY3Rpb24pO1xuICAgIH1cbiAgfSk7XG59XG5cbi8vIEZvcm1cblxuJChcIiNmb3JtXCIpLm9uKFwic3VibWl0XCIsIHN1Ym1pdEZvcm0pO1xuXG5mdW5jdGlvbiBzdWJtaXRGb3JtKGV2KSB7XG4gIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gIHZhciBmb3JtID0gJChldi50YXJnZXQpO1xuICByZXF1ZXN0ID0gYWpheEZvcm0oZm9ybSk7XG5cbiAgcmVxdWVzdC5kb25lKGZ1bmN0aW9uKG1zZykge1xuICAgIHZhciBtZXMgPSBtc2cubWVzLFxuICAgICAgc3RhdHVzID0gbXNnLnN0YXR1cztcbiAgICBpZiAoc3RhdHVzID09PSBcIk9LXCIpIHtcbiAgICAgIGZvcm0uYXBwZW5kKCc8cCBjbGFzcz1cInN1Y2Nlc3NcIj4nICsgbWVzICsgXCI8L3A+XCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBmb3JtLmFwcGVuZCgnPHAgY2xhc3M9XCJlcnJvclwiPicgKyBtZXMgKyBcIjwvcD5cIik7XG4gICAgfVxuICB9KTtcbiAgcmVxdWVzdC5mYWlsKGZ1bmN0aW9uKGpxWEhSLCB0ZXh0U3RhdHVzKSB7XG4gICAgYWxlcnQoXCJSZXF1ZXN0IGZhaWxlZDogXCIgKyB0ZXh0U3RhdHVzKTtcbiAgfSk7XG59XG4vLyBVbml2ZXJjaXR5IGZ1bmN0aW9uIGZvciB3b3JrIHdpdGggYWxsIGZvcm1zXG52YXIgYWpheEZvcm0gPSBmdW5jdGlvbihmb3JtKSB7XG4gIHZhciBkYXRhID0gZm9ybS5zZXJpYWxpemUoKSxcbiAgICB1cmwgPSBmb3JtLmF0dHIoXCJhY3Rpb25cIik7XG4gIHJldHVybiAkLmFqYXgoe1xuICAgIHR5cGU6IFwiUE9TVFwiLFxuICAgIHVybDogdXJsLFxuICAgIGRhdGFUeXBlOiBcIkpTT05cIixcbiAgICBkYXRhOiBkYXRhXG4gIH0pO1xufTtcblxuLy9ZYW5kZXggbWFwXG5cbnltYXBzLnJlYWR5KGluaXQpO1xuXG52YXIgcGxhY2VtYXJrcyA9IFtcbiAge1xuICAgIGxhdGl0dWRlOiA1OS45NyxcbiAgICBsb25naXR1ZGU6IDMwLjMxLFxuICAgIGhpbnRDb250ZW50OiAnPGRpdiBjbGFzcz1cIm1hcF9faGludFwiPtGD0LvQuNGG0LAg0JvQuNGC0LXRgNCw0LvQvtCyINC00L7QvCAxOSA8L2Rpdj4nLFxuICAgIGJhbGxvb25Db250ZW50OiBbXG4gICAgICAnPGRpdiBjbGFzcz1cIm1hcF9fYmFsbG9vblwiPicsXG4gICAgICBcItCh0LDQvNGL0LUg0LLQutGD0YHQvdGL0LUg0LHRg9GA0LPQtdGA0Ysg0YMg0L3QsNGBISDQl9Cw0YXQvtC00LjRgtC1INC/0L4g0LDQtNGA0LXRgdGDOiDRg9C7LiDQm9C40YLQtdGA0LDQu9C+0LIsINC0LiAxOVwiLFxuICAgICAgXCI8L2Rpdj5cIlxuICAgIF1cbiAgfSxcbiAge1xuICAgIGxhdGl0dWRlOiA1OS45NCxcbiAgICBsb25naXR1ZGU6IDMwLjI1LFxuICAgIGhpbnRDb250ZW50OiAnPGRpdiBjbGFzcz1cIm1hcF9faGludFwiPtCc0LDQu9GL0Lkg0L/RgNC+0YHQv9C10LrRgiDQkiDQniwg0LQgNjQ8L2Rpdj4nLFxuICAgIGJhbGxvb25Db250ZW50OiBbXG4gICAgICAnPGRpdiBjbGFzcz1cIm1hcF9fYmFsbG9vblwiPicsXG4gICAgICBcItCh0LDQvNGL0LUg0LLQutGD0YHQvdGL0LUg0LHRg9GA0LPQtdGA0Ysg0YMg0L3QsNGBISDQl9Cw0YXQvtC00LjRgtC1INC/0L4g0LDQtNGA0LXRgdGDOiDQnNCw0LvRi9C5INC/0YDQvtGB0L/QtdC60YIg0JIg0J4sINC0IDY0XCIsXG4gICAgICBcIjwvZGl2PlwiXG4gICAgXVxuICB9LFxuICB7XG4gICAgbGF0aXR1ZGU6IDU5LjkzLFxuICAgIGxvbmdpdHVkZTogMzAuMzQsXG4gICAgaGludENvbnRlbnQ6ICc8ZGl2IGNsYXNzPVwibWFwX19oaW50XCI+0L3QsNCxLiDRgNC10LrQuCDQpNC+0L3RgtCw0L3QutC40JEg0LQgNTYgPC9kaXY+JyxcbiAgICBiYWxsb29uQ29udGVudDogW1xuICAgICAgJzxkaXYgY2xhc3M9XCJtYXBfX2JhbGxvb25cIj4nLFxuICAgICAgXCLQodCw0LzRi9C1INCy0LrRg9GB0L3Ri9C1INCx0YPRgNCz0LXRgNGLINGDINC90LDRgSEg0JfQsNGF0L7QtNC40YLQtSDQv9C+INCw0LTRgNC10YHRgzog0L3QsNCxLiDRgNC10LrQuCDQpNC+0L3RgtCw0L3QutC40JEg0LQgNTZcIixcbiAgICAgIFwiPC9kaXY+XCJcbiAgICBdXG4gIH1cbl07XG5cbmZ1bmN0aW9uIGluaXQoKSB7XG4gIHZhciBtYXAgPSBuZXcgeW1hcHMuTWFwKFwibWFwXCIsIHtcbiAgICBjZW50ZXI6IFs1OS45NCwgMzAuMzJdLFxuICAgIHpvb206IDEyLFxuICAgIGNvbnRyb2xzOiBbXCJ6b29tQ29udHJvbFwiXSxcbiAgICBiZWhhdmlvcnM6IFtcImRyYWdcIl1cbiAgfSk7XG5cbiAgcGxhY2VtYXJrcy5mb3JFYWNoKGZ1bmN0aW9uKG9iaikge1xuICAgIHZhciBwbGFjZW1hcmsgPSBuZXcgeW1hcHMuUGxhY2VtYXJrKFxuICAgICAgW29iai5sYXRpdHVkZSwgb2JqLmxvbmdpdHVkZV0sXG4gICAgICB7XG4gICAgICAgIGhpbnRDb250ZW50OiBvYmouaGludENvbnRlbnQsXG4gICAgICAgIGJhbGxvb25Db250ZW50OiBvYmouYmFsbG9vbkNvbnRlbnQuam9pbihcIlwiKVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgaWNvbkxheW91dDogXCJkZWZhdWx0I2ltYWdlXCIsXG4gICAgICAgIGljb25JbWFnZUhyZWY6IFwiLi4vaW1nL21hcC9pY29uX19wb2ludC9tYXAtbWFya2VyLnN2Z1wiLFxuICAgICAgICBpY29uSW1hZ2VTaXplOiBbNDYsIDU3XSxcbiAgICAgICAgaWNvbkltYWdlT2Zmc2V0OiBbLTIzLCAtNTddXG4gICAgICB9XG4gICAgKTtcbiAgICBtYXAuZ2VvT2JqZWN0cy5hZGQocGxhY2VtYXJrKTtcbiAgfSk7XG4gIHZhciBjbHVzdGVyZXIgPSBuZXcgeW1hcHMuQ2x1c3RlcmVyKHt9KTtcbiAgbWFwLmdlb09iamVjdHMuYWRkKGNsdXN0ZXJlcik7XG59XG4iXX0=
